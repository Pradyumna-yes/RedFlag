<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relationship Analyzer</title>
    <style>
        .container { max-width: 800px; margin: 2rem auto; padding: 20px; text-align: center; }
        textarea { width: 100%; height: 150px; padding: 10px; font-size: 16px; }
        button { padding: 10px 20px; margin-top: 10px; font-size: 16px; cursor: pointer; }
        .result { margin-top: 20px; padding: 15px; background: #f5f5f5; display: none; }
        .error { color: red; margin-top: 10px; }
        .loading { font-style: italic; color: gray; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Analyze Your Conversation</h1>
        <textarea id="conversation" placeholder="Paste your conversation here..."></textarea>
        <button onclick="analyze()">Analyze Now</button>
        
        <p id="loading" class="loading" style="display: none;">Analyzing... Please wait.</p>
        <p id="error" class="error"></p>

        <div class="result" id="results">
            <h3>Analysis Results:</h3>
            <div id="relationship"></div>
            <div id="sentiment"></div>
            <div id="intentions"></div>
            <div id="topics"></div>
        </div>
    </div>

    <script>
        async function analyze() {
            const conversation = document.getElementById('conversation').value.trim();
            const resultsDiv = document.getElementById('results');
            const loadingText = document.getElementById('loading');
            const errorText = document.getElementById('error');

            if (!conversation) {
                errorText.textContent = "Please enter a conversation.";
                resultsDiv.style.display = "none";
                return;
            }

            // Clear previous results and show loading
            errorText.textContent = "";
            resultsDiv.style.display = "none";
            loadingText.style.display = "block";

            try {
                const response = await fetch('http://127.0.0.1:5000/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: conversation }) // Fixed key to "text"
                });

                if (!response.ok) {
                    throw new Error("Server error. Please try again later.");
                }

                const data = await response.json();

                // Hide loading
                loadingText.style.display = "none";

                // Display results
                resultsDiv.style.display = "block";
                document.getElementById('relationship').innerHTML = `
                    <strong>Relationship Type:</strong> <br>${data.relationship_type.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/###/g, '<br><b>').replace(/---/g, '<hr>')}
                `;

                document.getElementById('sentiment').innerHTML = `
                    <strong>Sentiment:</strong> ${data.sentiment || "Unknown"} (${(data.intensity || "medium")})
                `;

                document.getElementById('intentions').innerHTML = `
                    <strong>Intentions:</strong> ${(data.key_intentions && data.key_intentions.length > 0) ? data.key_intentions.join(', ') : "None detected"}
                `;

                document.getElementById('topics').innerHTML = `
                    <strong>Topics:</strong> ${(data.main_topics && data.main_topics.length > 0) ? data.main_topics.join(', ') : "No clear topics"}
                `;

            } catch (error) {
                loadingText.style.display = "none";
                errorText.textContent = error.message;
            }
        }
    </script>
</body>
</html>
